# Хватит писать циклы `for`. Время использовать нижнее подчёркивание.

![мальчик][никаких циклов for]

Сколько циклов `for` вы написали сегодня? А за эту неделю?

    var i;

    for(i = 0; i < someArray.length; i++) {
      var someThing = someArray[i];
      doSomeWorkOn(someThing);
    }

Ну конечно. Ничего страшного в этом нет. Код не очень приятный для глаз и 
немного непонятный, но в общем для жалоб повода нет. Но это всё уж слишком часто 
встречается:

    var i,
      j;

    for(i = 0; i < someArray.length; i++) {
      var someThing = someArray[i];
      for(j = 0; j < someThing.stuff.length; j++) {
          doSomeWorkOn(someThing.stuff[j]);
      }
    }

По шкале качества кода он **не так уж** плох, однако если добавить туда ещё 
парочку `if`, тут уж начинается полное безумие.

## За два года я не написал ни одного цикла `for`.

«Да ты гонишь»

Правду говорю. Чистой воды. Вообще ни одного (ну ладно, подловили, только что 
написал парочку выше), и благодаря такому воздержанию мой код намного более 
прост для понимания.

Как мне это удалось?

    _.each(someArray, function(someThing) {
      doSomeWorkOn(someThing);
    })

Или даже лучше:

    _.each(someArray, doSomeWorkOn); //спасибо, paulmcpazzi!

Это [underscorejs][1] в действии. Чистый, простой для чтения, короткий, никаких 
переменных, эшелонов точек с запятыми… ясный и чёткий.

Вот ещё пример:

    var i,
      result = [];

    for(i = 0; i < someArray.length; i++) {
      var someThing = someArray[i];
      // у меня уже руки отваливаются столько кода набирать
      if(someThing.isAwesome === true) {
          result.push(someArray[i]);
      }
    }

Опять же, типичный случай применения проверенных временем циклов `for`. Фу. Даже 
вид вот такого вот кода наполняет меня праведным негодованием как это случается 
с экс-курильщиками и новобращёнными веганами. 

    var result = _.filter(someArray, function(someThing) {
      return someThing.isAwesome === true;
    })

Как намекает имя метода с использованием нижнего подчеркивания, `filter`, эти 
удобные три строчки простого для парсинга кода дали мне новый **чудный массив**.

Или может мне нужно выполнить определённые действия с элементами массива и 
получить новый, содержащий результаты этих действий?

    var result = _.map(someArray, function(someThing) {
      return trasformTheThing(someThing);
    })

Эти три функции безумно полезны в ежедневной работе и затрагивают только малую 
часть возможностей, которые открывает нижнее подчёркивание.

    var grandTotal = 0,
      somePercentage = 1.07,
      severalNumbers = [33, 54, 42],
      i; // не забудьте увеличить индекс;

    for(i = 0; i < severalNumbers.length; i++) {
      var aNumber = severalNumbers[i];
      grandTotal += aNumber * somePercentage;
    }

Жесть.

    var somePercentage = 1.07,
      severalNumbers = [33, 54, 42],
      grandTotal;

    grandTotal = _.reduce(severalNumbers, function(runningTotal, aNumber) {
      return runningTotal + (aNumber * somePercentage);
    }, 0)

Сначала этот подход кажется странным и мне **всё ещё** приходится подглядывать в 
документацию когда речь идёт о методах вроде **`reduce`**. Однако 
осведомлённость о том, что они существуют и простой отказ от использования 
циклов `for` — вот моё главное оружие. Методы представленные выше — это лишь 
малая толика. Библиотека underscorejs наполнена потрясающими средствами такого 
рода, которые можно комбинировать для получения новых чудесных возможностей.

## Испытание: 30 дней без циклов

Стоп.

Следующие 30 дней откажитесь от циклов `for`. Если увидите кучку этой гадости, 
замените её на **`each`** или **`map`**. Сократите код тут и там. И сообщите мне 
о ваших успехах!

Осторожно. Нижнее подчёркивание — это врата в функциональное программирование. 
Однажды попробовав, вы уже не сможете отказаться. В хорошем смысле.

Если хотите копнуть глубже, ознакомьтесь с этим руководством по [функциональному 
программированию в javascript][2]. Оно очень хорошее и отнимет у вас около 
полчаса. Это описание основных принципов функций с нижним подчёркиванием, 
которые я использовал выше, нечто вроде «как делают сосиски». Кладезь веселья 
для нердов. 

**Примечание:** *В качестве более производительной альтернативы нижнему 
подчёркиванию, можете ознакомиться с [lodash][3]*

**Примечание:** *стоит также отметить что у современных браузеров присутствует 
встроенная поддержка описанных выше методов. `Array.forEach`, `Array.reduce` и 
`Array.map` имеют право на жизнь, однако для них вам вероятно потребуется 
создать фолбэк на случай отсутствия поддержки. Для меня намного более удобным 
является стабильный API для нижнего подчёркивания (lodash). Можете с этим не 
соглашаться.*

**Примечание:** *Да, с циклами `for` быстрее. Перед тем как вытиснуть из 
центрального процессора производительность, я занимаюсь оптимизацией для 
читабельности и простоты использования для моей комманды. Я не пишу игры или 
сложные анимированные пользовательские интерфейсы. Большие проекты, десятки 
разработчиков, код, который и без того стремится к разрушению и беспорядку.*

*Оптимизация с целью получить «чистый удобочитаемый код» приносит огромный 
результат, даже если даётся ценой (очень) несущественного ущерба для 
производительности.*

*Теперь готовя большой список элементов в Angular, мы сосредотачиваем внимание 
на производительности с точки зрения центрального процессора, но даже так 
единственный раз, когда мы зашли в тупик из-за неоптимизированной сетки с 
данными, случился для телефонов на Android прошлого поколения.*

*Чистота важнее всего! ;)*

[1]: http://underscorejs.org/
[2]: http://reactive-extensions.github.io/learnrx/
[3]: http://lodash.com/benchmarks

[никаких циклов for]: img/no_loops.jpg